{% extends 'base.html' %}

{% block content %}
<div class="song-detail-page">

  <!-- Current Song Section -->
  <div class="current-song d-flex align-items-center mb-4 p-3 border rounded shadow-sm">
    <img src="{{ song.artwork_url }}" alt="{{ song.track_name }}" class="song-artwork me-4">
    <div class="song-meta">
      <h1 class="song-title">{{ song.track_name }}</h1>
      <p class="song-artist">{{ song.artist_name }}</p>
      <p class="song-album text-muted">{{ song.album_name }} â€¢ {{ song.year }}</p>
      <div class="mt-3">
        <iframe src="https://open.spotify.com/embed/track/{{ song.track_id }}"
                width="300" height="80" frameborder="0"
                allowtransparency="true" allow="encrypted-media"></iframe>
      </div>
    </div>
  </div>

  <!-- Similar Songs Section -->
  <h2 class="section-title">Similar Songs</h2>
  <ul class="similar-songs list-unstyled">
    {% for s in similar_songs %}
      <li class="similar-song-item d-flex align-items-center border rounded p-2 mb-2 hover-bg">
        <a href="{% url 'song_detail' s.track_id %}" class="d-flex align-items-center text-decoration-none text-dark w-100">
          <img src="{{ s.artwork_url }}" alt="{{ s.track_name }}" class="similar-artwork me-3">
          <div>
            <p class="mb-0 fw-semibold">{{ s.track_name }}</p>
            <p class="mb-0 text-muted small">{{ s.artist_name }}</p>
            {% if s.match_pct %}
              <p class="mb-0 text-success small">{{ s.match_pct }}% match</p>
            {% endif %}
          </div>
        </a>
      </li>
    {% empty %}
      <li class="text-muted">No similar songs found.</li>
    {% endfor %}
  </ul>

  <!-- More From Same Artist Section -->
  <h2 class="section-title">More from Same Artist</h2>
  <div class="more-from grid">
    {% for artist, tracks in more_from.items %}
      <div class="artist-section col-span-full">
        <h3 class="artist-name">{{ artist }}</h3>
      </div>
      {% for t in tracks %}
        <a href="{% url 'song_detail' t.track_id %}" class="more-item border rounded p-2 text-decoration-none text-dark hover-bg">
          <img src="{{ t.artwork_url }}" alt="{{ t.track_name }}" class="more-artwork">
          <p class="more-title">{{ t.track_name }}</p>
        </a>
      {% endfor %}
    {% empty %}
      <p class="text-muted">No other tracks found for this artist.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
